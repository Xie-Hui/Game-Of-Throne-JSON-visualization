var json = {
  "Game of Throne Houses": [
        {
          "name": "Starks",
          "wikiSuffix": "House_Stark",
          "people": [
            {
              "name": "Eddard \"Ned\" Stark",
              "description": "Lord of Winterfell - Warden of the North - Hand of the King - Married to Catelyn (Tully) Stark",
              "imageSuffix": "eddard-stark",
              "wikiSuffix": "Eddard_Stark"
            },
            {
              "name": "Benjen Stark",
              "description": "Brother of Eddard Stark - First ranger of the Night's Watch",
              "imageSuffix": "benjen-stark",
              "wikiSuffix": "Benjen_Stark"
            },
            {
              "name": "Robb Stark",
              "description": "Son of Eddard and Catelyn Stark - Direwolf: Grey Wind",
              "imageSuffix": "robb-stark",
              "wikiSuffix": "Robb_Stark"
            },
            {
              "name": "Sansa Stark",
              "description": "Daughter of Eddard and Catelyn Stark - Direwolf: Lady",
              "imageSuffix": "sansa-stark",
              "wikiSuffix": "Sansa_Stark"
            },
            {
              "name": "Arya Stark",
              "description": "Daughter of Eddard and Catelyn Stark - Direwolf: Nymeria",
              "imageSuffix": "arya-stark",
              "wikiSuffix": "Arya_Stark"
            },
            {
              "name": "Brandon \"Bran\" Stark",
              "description": "Son of Eddard and Catelyn Stark - Direwolf: Summer",
              "imageSuffix": "brandon-stark",
              "wikiSuffix": "Brandon_Stark"
            },
            {
              "name": "Rickon Stark",
              "description": "Son of Eddard and Catelyn Stark - Direwolf: Shaggydog",
              "imageSuffix": "rickon-stark",
              "wikiSuffix": "Rickon_Stark"
            },
            {
              "name": "Jon Snow",
              "description": "Bastard son of Eddard Stark - Steweard in the Night's Watch - Direwolf: Ghost",
              "imageSuffix": "jon-snow",
              "wikiSuffix": "Jon_Snow"
            }
          ]
        },



        {
          "name": "Lannisters",
          "wikiSuffix": "House_Lannister",
          "people": [
            {
              "name": "Tywin Lannister",
              "description": "Lord of Casterly Rock - Warden of the West",
              "imageSuffix": "tywin-lannister",
              "wikiSuffix": "Tywin_Lannister"
            },
            {
              "name": "Tyrion Lannister",
              "description": "Son of Tywin Lannister - The Imp",
              "imageSuffix": "tyrion-lannister",
              "wikiSuffix": "Tyrion_Lannister"
            },
            {
              "name": "Jaime Lannister",
              "description": "The Kingslayer - Knight of the Kingsgaurd - Son of Tywin Lannister",
              "imageSuffix": "jaime-lannister",
              "wikiSuffix": "Jaime_Lannister"
            },
            {
              "name": "Queen Cersei (Lannister) Baratheon",
              "description": "Married to King Robert Baratheon - Daughter of Tywin Lannister",
              "imageSuffix": "cersei-lannister",
              "wikiSuffix": "Cersei_Lannister"
            }
          ]
        },


        {
          "name": "Baratheons",
          "wikiSuffix": "House_Baratheon",
          "people": [
            {
              "name": "King Robert Baratheon",
              "description": "The first of his name - Lord of the Seven Kingdoms",
              "imageSuffix": "robert-baratheon",
              "wikiSuffix": "Robert_Baratheon"
            },
            {
              "name": "Stannis Baratheon",
              "description": "Lord of Dragonstone - Master of Ships - Brother of Robert Baratheon",
              "imageSuffix": "stannis-baratheon",
              "wikiSuffix": "Stannis_Baratheon"
            },
            {
              "name": "Renly Baratheon",
              "description": "Lord of Storm's End - Master of Laws - Brother of Robert Baratheon",
              "imageSuffix": "renly-baratheon",
              "wikiSuffix": "Renly_Baratheon"
            },
            {
              "name": "Joffrey Baratheon",
              "description": "Heir to the Iron Throne - Son of Robert and Cersei Baratheon",
              "imageSuffix": "joffrey-baratheon",
              "wikiSuffix": "Joffrey_Baratheon"
            },
            {
              "name": "Tommen Baratheon",
              "description": "Son of Robert and Cersei Baratheon",
              "imageSuffix": "tommen-baratheon",
              "wikiSuffix": "Tommen_Baratheon"
            },
            {
              "name": "Myrcella Baratheon",
              "description": "Daughter of Robert and Cersei Baratheon",
              "imageSuffix": "myrcella-baratheon",
              "wikiSuffix": "Myrcella_Baratheon"
            }
          ]
        },




        {
          "name": "Targaryens",
          "wikiSuffix": "House_Targaryen",
          "people": [
            {
              "name": "Daenerys Targaryen",
              "description": "Stormborn - Khaleesi of the Dothraki - The Unburnt - Mother of Dragons - Daughter of Aerys II Targaryen \"The Mad King\"",
              "imageSuffix": "daenerys-targaryen",
              "wikiSuffix": "Daenerys_Targaryen"
            },
            {
              "name": "Viserys Targaryen",
              "description": "The Beggar King - Son of Aerys II Targaryen \"The Mad King\"",
              "imageSuffix": "viserys-targaryen",
              "wikiSuffix": "Viserys_Targaryen"
            }
          ]
        },



        {
          "name": "Greyjoys",
          "wikiSuffix": "House_Greyjoy",
          "people": [
            {
              "name": "Balon Greyjoy",
              "description": "Lord Reaper of Pyke - Head of House Greyjoy",
              "imageSuffix": "balon-greyjoy",
              "wikiSuffix": "Balon_Greyjoy"
            },
            {
              "name": "Theon Greyjoy",
              "description": "Ward of the Starks - Heir to the Iron Islands - Son of Balon Greyjoy",
              "imageSuffix": "theon-greyjoy",
              "wikiSuffix": "Theon_Greyjoy"
            },
            {
              "name": "Yara Greyjoy",
              "description": "Ironborn - Son of Balon Greyjoy",
              "imageSuffix": "yara-greyjoy",
              "wikiSuffix": "Yara_Greyjoy"
            }

          ]
        },

        {
          "name": "Tyrells",
          "wikiSuffix": "House_Tyrell",
          "people": [
            {
              "name": "Margaery (Tyrell) Baratheon",
              "description": "Wife of Renly Baratheon - Sister of Loras Tyrell - Granddaughter of Olenna Tyrell",
              "imageSuffix": "margaery-tyrell",
              "wikiSuffix": "Margaery_Tyrell"
            },
            {
              "name": "Loras Tyrell",
              "description": "Heir to Highgarden - Commander of the Kings Gaurd - Brother of Margaery Baratheon",
              "imageSuffix": "loras-tyrell",
              "wikiSuffix": "Loras_Tyrell"
            }

          ]
        },

        {
          "name": "Tullys",
          "wikiSuffix": "House_Tully",
          "people": [
            {
              "name": "Catelyn (Tully) Stark",
              "description": "Married to Eddard Stark - Daughter of Hoster Tully",
              "imageSuffix": "catelyn-tully",
              "wikiSuffix": "Catelyn_Tully"
            },
            {
              "name": "Lysa (Tully) Arryn",
              "description": "Widow of Jon Arryn - Daughter of Hoster Tully",
              "imageSuffix": "lysa-tully",
              "wikiSuffix": "Lysa_Tully"
            },
            {
              "name": "Edmure Tully",
              "description": "Heir to Riverrun - Son of Hoster Tully",
              "imageSuffix": "edmure-tully",
              "wikiSuffix": "Edmure_Tully"
            },
            {
              "name": "Brynden Tully",
              "description": "Lord of Riverrun - Head of House Tully - Brother of Hoster Tully",
              "imageSuffix": "brynden-tully",
              "wikiSuffix": "Brynden_Tully"
            }

          ]
        },

        {
          "name": "Redwyne",
          "wikiSuffix": "House_Redwyne",
          "people": [
            {
              "name": "Olenna (Redwyne) Tyrell",
              "description": "Matriarch of House Tyrell - Queen of Thorns",
              "imageSuffix": "olenna-tyrell",
              "wikiSuffix": "Olenna_Tyrell"
            }

          ]
        },

        {
          "name": "Freys",
          "wikiSuffix": "House_Freys",
          "people": [
            {
              "name": "Walder Frey",
              "description": "Lord of the Crossing - Head of House Frey",
              "imageSuffix": "walder-frey",
              "wikiSuffix": "Walder_Frey"
            }

          ]
        },

        {
          "name": "Arryns",
          "wikiSuffix": "House_Arryns",
          "people": [
            {
              "name": "Jon Arryn",
              "description": "Lord of the Eyrie - Head of House Arryn - Warden of the East - Defender of the Vale",
              "imageSuffix": "jon-arryn",
              "wikiSuffix": "Jon_Arryn"
            }

          ]
        },

        {
          "name": "Dothrakis",
          "wikiSuffix": "House_Dothrakis",
          "people": [
            {
              "name": "Khal Drogo",
              "description": "Leader of the Dothraki people - Dothraki Warlord - Married to Daenerys Targaryen",
              "imageSuffix": "khal-drogo",
              "wikiSuffix": "Drogo"
            }

          ]
        }

      ]
    }


var camera, scene, renderer
var cameraDistance = 1500
var layout_Radius = 1500
var focusQueue = []

var objects = []
    targets_focus = []
    targets_away = []

    objects_depth = []
    objects_index = []
    objects_siblings = []

var sceneWebgl, rendererWebgl;

window.onload = function(){

    setup();
    animate();

}


function setup() {

    camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 10000 );
	camera.position.z = cameraDistance;
    //cameraPositionQueue.push(camera)
	scene = new THREE.Scene();

    //vanishPt = new THREE.Vector3(0,0,-100);
    //camera.lookAt(vanishPt);


    createCvElements()

    renderer = new THREE.CSS3DRenderer();
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.domElement.style.position = 'absolute';
	document.getElementById( 'container' ).appendChild( renderer.domElement );

    //createParticles();
}


function animate() {
    requestAnimationFrame( animate );
    TWEEN.update();
    render();
}

function render() {
    //particleUpdate();
    renderer.render( scene, camera );
    //rendererWebgl.render( sceneWebgl, camera );
    //cameraWander();
}

function transform( targets, duration = 2000 ){

    TWEEN.removeAll();
    /**
    new TWEEN.Tween( camera.position )
        .to({ x: cameraTarget.x, y: cameraTarget.y, z: cameraTarget.z }, duration )
        .easing( TWEEN.Easing.Exponential.InOut )
        .start();
    */

    //move camera to starting location
    for ( var i = 0; i < objects.length; i++ ) {

        var target = [0,0,0]
        var object = objects[i]
        var targetId = object.element.id
        //console.log( "targetId: ", targetId );

        target = targets[ targetId ]
        //console.log("target: ", targets);

        //console.log("target!!!!!:", target);
        new TWEEN.Tween( object.position )
            .to({ x: target[0], y: target[1], z: target[2] }, duration )
            .easing( TWEEN.Easing.Exponential.InOut )
            .start();

    }

    new TWEEN.Tween( this )
            .to( {}, duration * 2 )
            .onUpdate( render )
            .start();

}

function moveCamera( target, duration ) {

    TWEEN.removeAll();
    console.log("camera moving!!!");
    console.log("target: ", target);

    new TWEEN.Tween( camera.position )
        .to({ x: target.x, y: target.y, z: target.z }, duration )
        .easing( TWEEN.Easing.Exponential.InOut )
        .start();

}

Math.radians = function(degrees) {
  return degrees * Math.PI / 180;
};


function createDOM() {

    var container = document.getElementById( "container" )

    //var menu_count = menu_total( json[] )
    var JsonData = json["Game of Throne Houses"]

    //the 1st level content container
    var newContent = document.createElement( "div" )
    newContent.className = "content-container"
    newContent.textContent = "Game of Thrones Houses"
    container.appendChild( newContent )


    //how many houses are there to put in a radial structure?
    var houseCount = 0
    for ( var key_house in JsonData ) {

        var JsonData_house = JsonData[ key_house ]
        if ( JsonData_house instanceof Object ) {

            houseCount++

        }

    }

    //console.log("houseCount: ", houseCount);
    //index for placing the items
    var i = 0
    //iterate through each 1st level entries, i.e. houses
    for ( var key_house in JsonData ) {

        var JsonData_house = JsonData[ key_house ]

        if ( JsonData_house instanceof Object ) {

            //for each house create a navigation portal
            //assign the id as house name to point to the next level people containers
            var newPortal = document.createElement( "div" )
            newPortal.className = "portal"
            newPortal.id = JsonData_house[ "name" ]
            newPortal.textContent = JsonData_house[ "name" ]
            container.appendChild( newPortal )

            //position to circle
            var object = new THREE.CSS3DObject(newPortal)
            objects.push(object)

            targets_focus[newPortal.id] = getPosition_focus(200, 0, i, houseCount)
            targets_away[newPortal.id] = getPosition_away(500)
            i++

            object.position.x = targets_focus[newPortal.id][0]
            object.position.y = targets_focus[newPortal.id][1]
            object.position.z = targets_focus[newPortal.id][2]

            scene.add(object)

            //console.log("focus: ", targets_focus);
            //targets_away = getPosition_away()

            ////extract people in current house
            var JsonData_people = JsonData_house["people"]
            //console.log( "people: ", JsonData_people )

            //how many people are there to put in a radial structure?
            var peopleCount = 0
            for ( var key_people in JsonData_people ) {

                peopleCount++

            }
            //iterate through people
            //console.log("people: ", peopleCount);

            var j = 0

            for ( var key_people in JsonData_people ) {

                //for each person in current house create a container card
                //that has multiple iterms i.e. name, discription, ...
                var JsonData_person = JsonData_people[ key_people ]

                var container_people = document.createElement( "div" )
                container_people.className = JsonData_house[ "name" ]
                container_people.id = JsonData_person[ "name" ]

                for ( var key_person in JsonData_person ) {

                    //on person card create items
                    var newNode = document.createElement( "div" )
                    newNode.className = key_person
                    newNode.textContent = JsonData_person[ key_person ]
                    container_people.appendChild( newNode )

                }

                container.appendChild( container_people )

                var object = new THREE.CSS3DObject( container_people )
                objects.push(object)

                targets_focus[ container_people.id ] = getPosition_focus(400, 0, j, peopleCount)
                targets_away[ container_people.id ] = getPosition_away(1000)
                j++

                //console.log("position: ", targets_focus[ container_people.id ]);
                object.position.x = targets_focus[ container_people.id ][0]
                object.position.y = targets_focus[ container_people.id ][1]
                object.position.z = targets_focus[ container_people.id ][2]
                scene.add(object)

            }

            ////

        }
        console.log("targets_away: ", targets_away);

    }

}


function getPosition_focus( r, depth, index, nodeTotal ) {

    return([

        r * Math.sin(Math.radians(index * 360 / nodeTotal)),  // x
        r * Math.cos(Math.radians(index * 360 / nodeTotal)),  // y
        depth//z

    ])

}

function getPosition_away( r ) {
    /*
    return(
         new THREE.Vector3(
             (Math.random() * 10000 + 10000) * (Math.random() > 0.5 ? 1: -1),
             (Math.random() * 10000 + 10000) * (Math.random() > 0.5 ? 1: -1),
             Math.random() * 5000 - 5000
         )
    )
    */
    return(
        [
            (Math.random() * r + r) * (Math.random() > 0.5 ? 1: -1),
            (Math.random() * r + r) * (Math.random() > 0.5 ? 1: -1),
            0
        ]
    )
}


function cameraRollback() {

    var tmp = new THREE.Vector3(0, 0, cameraDistance)
    moveCamera( tmp, 1000 )

}

function createEvents() {


    //setup the default camera focus
    //var tmp = new THREE.Vector3(300, 0, cameraDistance)
    //focusQueue.push(tmp)

    var portals = document.getElementsByClassName("portal");
    console.log("portals: ", portals);
    //console.log("objects: ", objects);

    for ( var portal of portals ) {

        //console.log("menu: ", menu);
        portal.addEventListener('click', function() {

            console.log("clicked!!!!")
            //console.log("menu: ", menu )
            var targetId = this.id
            //console.log("targetId: ", targetId);
            var targets = document.getElementsByClassName(targetId)
            //console.log("targets: ", targets);

            var focus = Object.assign({}, targets_away)
            //console.log(targets_away.slice());
            //console.log("focues: ", focus);
            for ( var key in targets ) {

                //console.log("target: ", targets[key]);
                focus[ targets[key].id ] = targets_focus[ targets[key].id ]
                //console.log("targetId: ", targets[key].id);
                //console.log("focus: ", focus[ targets[key].id ]);

            }
            //console.log("focused: ", focus);
            transform( focus )
            //console.log("objects: ", objects);
            //focusQueue.push(tmp)
            //var tmp = new THREE.Vector3( cameraDistance, 0, cameraDistance )
            //transform( targetId, tmp, 1000 )


        }, false);

    }

    //right click to go back to previous camera position
    document.addEventListener("mousedown", function(e) {
        //console.log(e); // you can inspect the click event

        if (e.which === 3) { // right click = 3, left click = 1

            //console.log("right click");
            //cameraRollback()
            var focus = Object.assign({}, targets_away)
            //console.log("focues: ", focus);
            var targets = document.getElementsByClassName("portal")
            console.log("targets: ", targets);
            for ( var key in targets ) {

                console.log("target: ", targets[key]);
                focus[ targets[key].id ] = targets_focus[ targets[key].id ]
                console.log("targetId: ", targets[key].id);
                //console.log("focus: ", focus[ targets[key].id ]);

            }
            //console.log("focused: ", focus);
            transform( focus )

        }
    });

    //double click on screen
    document.addEventListener("dblclick", function() {

        //console.log("double cllick!");
        //cameraRollback()

    })

    // prevent context menu show up
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
    }, false);

}

function createCvElements(){

    //tmp = document.createElement("div")
    //tmp.className = "root"
    //var container = document.getElementById( "container" )
    createDOM( )
    //console.log("objects: ", objects);
    //console.log("depth: ", objects_depth);
    //config_CSSobjs()

    //adding the event listeners
    createEvents()



}
